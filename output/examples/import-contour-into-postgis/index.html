<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Import contour lines data into PostGIS - Apache Baremaps</title>
    
    <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
          <div class="four columns">
            <header>
              <h2 class="logo"><a href="/"><i class="far fa-map"></i> Apache Baremaps</a></h2>
              <p>Apache Baremaps is a toolkit and a set of infrastructure components for creating, publishing, and operating online maps. It provides a data pipeline enabling developers to build maps with different data sources with live reload capabilities. It provides other services commonly used in online maps, such as location search and IP to location.</p>
              <p>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps" data-size="large" data-show-count="true"
                   aria-label="Star apache/incubator-baremaps on GitHub">Star</a>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps/releases/latest"
                   data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large"
                   aria-label="Download apache/incubator-baremaps on GitHub">Download</a>
              </p>
            </header>
            <nav>
              <ul>
                
                <li>
                  <a href="/about/"><i class="fas fa-info-circle"></i> About</a>
                  
                </li>
                
                <li>
                  <a href="/getting-started/"><i class="fas fa-rocket"></i> Getting Started</a>
                  
                  <ul>
                    
                    <li><a href="/getting-started/installing-the-cli/">Installing the CLI</a></li>
                    
                    <li><a href="/getting-started/installing-postgis/">Installation PostGIS</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/examples/"><i class="fas fa-vial"></i> Examples</a>
                  
                  <ul>
                    
                    <li><a href="/examples/import-osm-into-postgis/">Import OSM data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-naturalearth-into-postgis/">Import Natural Earth data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-contour-into-postgis/">Import contour lines into PostGIS</a></li>
                    
                    <li><a href="/examples/serve-vector-tiles/">Serve vector tiles from PostGIS</a></li>
                    
                    <li><a href="/examples/ip-to-location/">Create an IP to location web service</a></li>
                    
                    <li><a href="/examples/geocoding/">Create a geocoding web service</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/developer-manual/"><i class="fas fa-code"></i> Developer Manual</a>
                  
                  <ul>
                    
                    <li><a href="/developer-manual/project-structure/">Project structure</a></li>
                    
                    <li><a href="/developer-manual/how-to-build-with-maven/">How to build with Maven</a></li>
                    
                    <li><a href="/developer-manual/setup-in-intellij/">Set up in IntelliJ IDEA</a></li>
                    
                    <li><a href="/developer-manual/geocoder/">Geocoder</a></li>
                    
                    <li><a href="/developer-manual/ip-to-location/">IP to location</a></li>
                    
                    <li><a href="/developer-manual/stylesheet/">Stylesheet</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/assets/demo.html"><i class="fas fa-map"></i> Demo</a>
                  
                </li>
                
              </ul>
            </nav>
          </div>
          <article class="eight columns">
            <h1 id="import-contour-lines-data-into-postgis">Import contour lines data into PostGIS</h1>

<p>In this tutorial, we demonstrate how to produce contours from a digital elevation model (DEM).</p>

<p>Notice that the following steps assume that the Apache Baremaps CLI and PostGIS are <a href="https://www.baremaps.com/getting-started/">installed</a>.</p>

<h2 id="dataset">Dataset</h2>

<p>The approach consists in using the <a href="https://gdal.org/programs/gdal_contour.html"><code class="language-plaintext highlighter-rouge">gdal_contour</code></a> command.
Therefore, start by installing <code class="language-plaintext highlighter-rouge">gdal</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gdal-bin
</code></pre></div></div>

<p>The geotiff present in this directory comes from the <a href="https://asterweb.jpl.nasa.gov/gdem.asp">ASTER</a> dataset.
We used the following command to reproject the geotiff in the desired projection (e.g. WebMercator) before importing it in the database.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdalwarp -rc \
  -s_srs epsg:4326 -t_srs epsg:3857 \
  -dstnodata 0 -of GTiff -co tiled=yes \
  examples/contour/liecthenstein-aster-dem-v2.tif \
  examples/contour/liecthenstein-aster-dem-v2-3857.tif
</code></pre></div></div>

<h2 id="importing-the-data-into-postgis">Importing the data into PostGIS</h2>

<p>You can now import any GeoTiff DEM as contours in postgis. 
In the following command, the <code class="language-plaintext highlighter-rouge">-nln</code> argument name the table that contains the data, 
the <code class="language-plaintext highlighter-rouge">-a</code> argument name the column that contains the elevation, 
the <code class="language-plaintext highlighter-rouge">-i</code> argument specifies the interval in meters at which contours are generated.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdal_contour \
  -a elevation -nln aster_dem -i 10 \
  -f PostgreSQL \
  examples/contour/liecthenstein-aster-dem-v2-3857.tif "PG:host=localhost user=baremaps password=baremaps dbname=baremaps"
</code></pre></div></div>

<p>Some index can now be added to the database to improve performances. 
When available, a smoothing function such as <code class="language-plaintext highlighter-rouge">ST_ChaikinSmoothing</code> can be used to improve rendering of the contours.</p>

<pre><code class="language-postgresql">DROP INDEX IF EXISTS aster_dem_gix;
CREATE INDEX CONCURRENTLY IF NOT EXISTS aster_dem_gix ON aster_dem USING SPGIST(wkb_geometry);
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial, we learnt how to import contour lines in PostGIS.</p>

<p>Now that you have inserted the contour data into the PostGIS database, you can use follow the <a href="/examples/serve-vector-tiles">Serve Vector Tiles from PostGIS</a> example to serve
your PostGIS data directly as Vector Tiles in a web application with live reload capabilities.</p>

            <p><a class="edit" href="https://github.com/apache/incubator-baremaps-site/edit/main/examples/import-contour-into-postgis/index.md"><i class="fas fa-edit"></i> Improve this page</a></p>
          </article>
      </div>
    </div>
    <script async defer src="https://kit.fontawesome.com/14dcd5fdfb.js" crossorigin="anonymous"></script>
    <script async defer src="https://buttons.github.io/buttons.js" crossorigin="anonymous"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contour Lines in Vector Tiles - Apache Baremaps</title>
    
    <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
          <div class="four columns">
            <header>
              <h2 class="logo"><a href="/"><i class="far fa-map"></i> Apache Baremaps</a></h2>
              <p>Apache Baremaps is a toolkit and a set of infrastructure components for creating, publishing, and operating online maps. It provides a data pipeline enabling developers to build maps with different data sources with live reload capabilities. It provides other services commonly used in online maps, such as location search and IP to location.</p>
              <p>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps" data-size="large" data-show-count="true"
                   aria-label="Star apache/incubator-baremaps on GitHub">Star</a>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps/releases/latest"
                   data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large"
                   aria-label="Download apache/incubator-baremaps on GitHub">Download</a>
              </p>
            </header>
            <nav>
              <ul>
                
                <li>
                  <a href="/about/"><i class="fas fa-info-circle"></i> About</a>
                  
                </li>
                
                <li>
                  <a href="/getting-started/"><i class="fas fa-rocket"></i> Getting Started</a>
                  
                  <ul>
                    
                    <li><a href="/getting-started/installing-the-cli/">Installing the CLI</a></li>
                    
                    <li><a href="/getting-started/installing-postgis/">Installation PostGIS</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/examples/"><i class="fas fa-vial"></i> Examples</a>
                  
                  <ul>
                    
                    <li><a href="/examples/import-osm-into-postgis/">Import OSM data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-naturalearth-into-postgis/">Import Natural Earth data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-contour-into-postgis/">Import contour lines into PostGIS</a></li>
                    
                    <li><a href="/examples/serve-vector-tiles/">Serve vector tiles from PostGIS</a></li>
                    
                    <li><a href="/examples/extrusion/">Extrusion of vector tiles from OSM data</a></li>
                    
                    <li><a href="/examples/ip-to-location/">Create an IP to location web service</a></li>
                    
                    <li><a href="/examples/geocoding/">Create a geocoding web service</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/developer-manual/"><i class="fas fa-code"></i> Developer Manual</a>
                  
                  <ul>
                    
                    <li><a href="/developer-manual/project-structure/">Project structure</a></li>
                    
                    <li><a href="/developer-manual/how-to-build-with-maven/">How to build with Maven</a></li>
                    
                    <li><a href="/developer-manual/setup-in-intellij/">Set up in IntelliJ IDEA</a></li>
                    
                    <li><a href="/developer-manual/geocoder/">Geocoder</a></li>
                    
                    <li><a href="/developer-manual/ip-to-location/">IP to location</a></li>
                    
                    <li><a href="/developer-manual/stylesheet/">Stylesheet</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="https://demo.baremaps.com/"><i class="fas fa-map"></i> Demo</a>
                  
                </li>
                
              </ul>
            </nav>
          </div>
          <article class="eight columns">
            <h1 id="contour-lines-in-vector-tiles">Contour Lines in Vector Tiles</h1>

<p>Contour lines are a key element in topographic maps, as they allow us to 
visualize the elevation of an area. In this tutorial, we will show you how 
to create contour lines from a digital elevation model (DEM) and display 
them using vector tiles.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To follow this tutorial, you will need to have <code class="language-plaintext highlighter-rouge">gdal</code> installed on your 
system. If you don’t have it already, you can install it by running the 
following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gdal-bin
</code></pre></div></div>

<h2 id="reprojecting-the-geotiff">Reprojecting the GeoTiff</h2>

<p>We will be using the <a href="https://asterweb.jpl.nasa.gov/gdem.asp">ASTER</a> dataset 
for this example. The geotiff file provided in this tutorial is already in 
the desired projection (WebMercator), but in case you want to use a different 
geotiff file, you can use the gdalwarp command to reproject it. Here’s an 
example of how to do it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdalwarp -rc \
  -s_srs epsg:4326 -t_srs epsg:3857 \
  -dstnodata 0 -of GTiff -co tiled=yes \
  liecthenstein-aster-dem-v2.tif \
  liecthenstein-aster-dem-v2-3857.tif
</code></pre></div></div>

<h2 id="generating-the-contour-lines">Generating the Contour Lines</h2>

<p>Now that we have the GeoTiff in the desired projection, 
we can use the gdal_contour command to generate the contour lines. 
The <code class="language-plaintext highlighter-rouge">-a</code> argument specifies the column that contains the elevation data, 
the <code class="language-plaintext highlighter-rouge">-i</code> argument specifies the interval at which contours 
should be generated (in this case, we are using 10 meters), 
and the <code class="language-plaintext highlighter-rouge">-nln</code> argument names the table that will contain the data.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdal_contour \
  -a elevation -nln aster_dem -i 10 \
  -f PostgreSQL \
  liecthenstein-aster-dem-v2-3857.tif "PG:host=localhost user=baremaps password=baremaps dbname=baremaps"
</code></pre></div></div>

<h2 id="improving-performance-with-indexes">Improving Performance with Indexes</h2>

<p>To improve the performance of the contour lines, 
we can add some indexes to the database. 
Here’s an example of how to create a <code class="language-plaintext highlighter-rouge">SPGIST</code> index:</p>

<pre><code class="language-postgresql">DROP INDEX IF EXISTS aster_dem_gix;
CREATE INDEX IF NOT EXISTS aster_dem_gix ON aster_dem USING SPGIST(wkb_geometry);
</code></pre>

<h2 id="displaying-the-contour-lines">Displaying the Contour Lines</h2>

<p>Finally, we can use Baremaps to display the contour lines in a web browser. 
To do this, run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>baremaps map dev <span class="se">\</span>
  <span class="nt">--database</span> <span class="s1">'jdbc:postgresql://localhost:5432/baremaps?user=baremaps&amp;password=baremaps'</span> <span class="se">\</span>
  <span class="nt">--tileset</span> <span class="s1">'tileset.json'</span> <span class="se">\</span>
  <span class="nt">--style</span> <span class="s1">'style.json'</span>
</code></pre></div></div>

<p>This will start the tile server and automatically reload the configuration 
files when you make changes. You can then preview the map in your 
web browser.</p>

<h2 id="optional-smoothing-the-contour-lines">Optional: Smoothing the Contour Lines</h2>

<p>If you want to improve the rendering of the contour lines, you can use 
a smoothing function like ST_ChaikinSmoothing. This function takes 
a geometry as input and returns a smoothed version of that geometry. 
Here’s an example of how you could use it:</p>

<pre><code class="language-postgresql">UPDATE aster_dem
SET wkb_geometry = ST_ChaikinSmoothing(wkb_geometry, 0.1)
</code></pre>

<p>Keep in mind that this step is optional and might not be necessary depending 
on the quality of your input data. You can experiment with different 
smoothing parameters to find the best balance between smoothness and 
preservation of original features.</p>

<p>That’s it! You now know how to generate and display contour lines from 
a digital elevation model using vector tiles. Happy mapping!</p>

            <p><a class="edit" href="https://github.com/apache/incubator-baremaps-site/edit/main/examples/import-contour-into-postgis/index.md"><i class="fas fa-edit"></i> Improve this page</a></p>
          </article>
      </div>
    </div>
    <script async defer src="https://kit.fontawesome.com/14dcd5fdfb.js" crossorigin="anonymous"></script>
    <script async defer src="https://buttons.github.io/buttons.js" crossorigin="anonymous"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Import OSM data into PostGIS - Apache Baremaps</title>
    
    <link rel="stylesheet" href="/assets/css/main.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
          <div class="four columns">
            <header>
              <h2 class="logo"><a href="/"><i class="far fa-map"></i> Apache Baremaps</a></h2>
              <p>Apache Baremaps is a toolkit and a set of infrastructure components for creating, publishing, and operating online maps. It provides a data pipeline enabling developers to build maps with different data sources with live reload capabilities. It provides other services commonly used in online maps, such as location search and IP to location.</p>
              <p>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps" data-size="large" data-show-count="true"
                   aria-label="Star apache/incubator-baremaps on GitHub">Star</a>
                <a class="github-button" href="https://github.com/apache/incubator-baremaps/releases/latest"
                   data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large"
                   aria-label="Download apache/incubator-baremaps on GitHub">Download</a>
              </p>
            </header>
            <nav>
              <ul>
                
                <li>
                  <a href="/about/"><i class="fas fa-info-circle"></i> About</a>
                  
                </li>
                
                <li>
                  <a href="/getting-started/"><i class="fas fa-rocket"></i> Getting Started</a>
                  
                  <ul>
                    
                    <li><a href="/getting-started/installing-the-cli/">Installing the CLI</a></li>
                    
                    <li><a href="/getting-started/installing-postgis/">Installation PostGIS</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/examples/"><i class="fas fa-vial"></i> Examples</a>
                  
                  <ul>
                    
                    <li><a href="/examples/import-osm-into-postgis/">Import OSM data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-naturalearth-into-postgis/">Import Natural Earth data into PostGIS</a></li>
                    
                    <li><a href="/examples/import-contour-into-postgis/">Import contour lines into PostGIS</a></li>
                    
                    <li><a href="/examples/serve-vector-tiles/">Serve vector tiles from PostGIS</a></li>
                    
                    <li><a href="/examples/ip-to-location/">Create an IP to location web service</a></li>
                    
                    <li><a href="/examples/geocoding/">Create a geocoding web service</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/developer-manual/"><i class="fas fa-code"></i> Developer Manual</a>
                  
                  <ul>
                    
                    <li><a href="/developer-manual/project-structure/">Project structure</a></li>
                    
                    <li><a href="/developer-manual/how-to-build-with-maven/">How to build with Maven</a></li>
                    
                    <li><a href="/developer-manual/setup-in-intellij/">Set up in IntelliJ IDEA</a></li>
                    
                    <li><a href="/developer-manual/geocoder/">Geocoder</a></li>
                    
                    <li><a href="/developer-manual/ip-to-location/">IP to location</a></li>
                    
                    <li><a href="/developer-manual/stylesheet/">Stylesheet</a></li>
                    
                  </ul>
                  
                </li>
                
                <li>
                  <a href="/assets/demo.html"><i class="fas fa-map"></i> Demo</a>
                  
                </li>
                
              </ul>
            </nav>
          </div>
          <article class="eight columns">
            <h1 id="import-osm-data-into-postgis">Import OSM data into PostGIS</h1>

<p>In this tutorial, we’ll learn how to use Baremaps to import contour lines data in a PostGIS database.</p>

<p>Notice that the following steps assume that the Apache Baremaps CLI and PostGIS are <a href="https://www.baremaps.com/getting-started/">installed</a>.</p>

<p>Also, if you are in a hurry, consider skipping the “Under the Hood” sections.</p>

<h2 id="dataset">Dataset</h2>

<p>OpenStreetMap (OSM) is a free and editable map of the world.
It is maintained by a community of passionate volunteers in a way which is similar to Wikipedia.
Every week, OpenStreetMap publishes a <a href="https://planet.openstreetmap.org/">full dump</a> of its data in two flavours: a large XML file of about 90GB and a more compact binary file of about 50GB in the  <a href="https://developers.google.com/protocol-buffers">Protocol Buffer Format</a> (PBF).
As processing such large files can take several hours, <a href="http://www.geofabrik.de/data/download.html">Geofabrik</a> regularly publishes smaller extracts of OSM for specific regions.
In this example we will use a tiny extract of OSM for <a href="https://en.wikipedia.org/wiki/Liechtenstein">Liechtenstein</a>, which is suitable for fast experiments.</p>

<h2 id="importing-openstreetmap-data">Importing OpenStreetMap Data</h2>

<p>A workflow is a directed acyclic graph of steps executed by Baremaps.
To download and import the sample OSM data in Postgres, execute the following <a href="https://raw.githubusercontent.com/apache/incubator-baremaps/main/examples/openstreetmap/workflow.json">workflow</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>baremaps workflow execute --file examples/openstreetmap/workflow.json
</code></pre></div></div>

<p>Depending on the size of the OpenStreetMap file, the execution of this command may take some time.
Eventually, the output produced by the command should look as follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO ] 2022-07-26 09:47:40.906 [main] Workflow - Executing workflow workflow.json
[INFO ] 2022-07-26 09:47:41.208 [pool-2-thread-1] DownloadUrl - Downloading https://download.geofabrik.de/europe/liechtenstein-latest.osm.pbf to liechtenstein-latest.osm.pbf
[INFO ] 2022-07-26 09:48:14.496 [pool-2-thread-1] DownloadUrl - Finished downloading https://download.geofabrik.de/europe/liechtenstein-latest.osm.pbf to liechtenstein-latest.osm.pbf
[INFO ] 2022-07-26 09:48:14.497 [pool-2-thread-2] ImportOpenStreetMap - Importing liechtenstein-latest.osm.pbf into jdbc:postgresql://localhost:5432/baremaps?&amp;user=baremaps&amp;password=baremaps
[INFO ] 2022-07-26 09:48:14.504 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Starting...
[INFO ] 2022-07-26 09:48:14.669 [pool-2-thread-2] HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@13d835e3
[INFO ] 2022-07-26 09:48:14.671 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Start completed.
[INFO ] 2022-07-26 09:48:19.172 [pool-2-thread-2] ImportOpenStreetMap - Finished importing liechtenstein-latest.osm.pbf into jdbc:postgresql://localhost:5432/baremaps?&amp;user=baremaps&amp;password=baremaps
[INFO ] 2022-07-26 09:48:19.172 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Shutdown initiated...
[INFO ] 2022-07-26 09:48:19.177 [pool-2-thread-2] HikariDataSource - HikariPool-1 - Shutdown completed.
[INFO ] 2022-07-26 09:48:19.178 [pool-2-thread-3] ExecuteSqlFile - Executing indexes.sql into jdbc:postgresql://localhost:5432/baremaps?&amp;user=baremaps&amp;password=baremaps
[INFO ] 2022-07-26 09:48:19.179 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Starting...
[INFO ] 2022-07-26 09:48:19.213 [pool-2-thread-3] HikariPool - HikariPool-2 - Added connection org.postgresql.jdbc.PgConnection@25c4ab89
[INFO ] 2022-07-26 09:48:19.213 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Start completed.
[INFO ] 2022-07-26 09:48:21.365 [pool-2-thread-3] ExecuteSqlFile - Finished executing indexes.sql into jdbc:postgresql://localhost:5432/baremaps?&amp;user=baremaps&amp;password=baremaps
[INFO ] 2022-07-26 09:48:21.365 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Shutdown initiated...
[INFO ] 2022-07-26 09:48:21.367 [pool-2-thread-3] HikariDataSource - HikariPool-2 - Shutdown completed.
[INFO ] 2022-07-26 09:48:21.368 [main] Workflow - Finished executing workflow workflow.json
</code></pre></div></div>

<h3 id="under-the-hood-optional">Under the Hood (Optional)</h3>

<p>What can we learn from this output?
First, we notice that Baremaps uses a connection pool to parallelize the import procedure.
Then it imports the OSM data, populating the tables previously created.
In our case, the input is a file provided by Geofabrik.</p>

<p>OSM’s <a href="https://wiki.openstreetmap.org/wiki/Elements">conceptual model</a> builds upon the notions of nodes, ways and relations.
In this normalized data model, a line (or way) is formed by a sequence of points (nodes) referenced by their id.
In order to save denormalized geometries in PostGIS (e.g. linestring, polygon, multi-polygon, etc.), Baremaps creates a cache for nodes, ways and relations.
<a href="https://symas.com/lmdb/">LMDB</a> is used under the hood to achieve great performance.</p>

<p>After the creation of the cache, Baremaps can populate the database with geometries.
The geometries are stored in three tables named after the OSM conceptual model: <code class="language-plaintext highlighter-rouge">osm_nodes</code>, <code class="language-plaintext highlighter-rouge">osm_ways</code>, and <code class="language-plaintext highlighter-rouge">osm_relations</code>.
In order to improve performances at query time, Baremaps also creates indexes for the tags and the geometries.
The following Figure displays the schema of the PostGIS database created by Baremaps.</p>

<p><img src="database.png" alt="PostGIS database" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial, we learnt how to import OpenStreetMap data in PostGIS.</p>

<p>Now that you have inserted the OSM data into the PostGIS database, you can use follow the <a href="/examples/serve-vector-tiles">Serve Vector Tiles from PostGIS</a> example to serve 
your PostGIS data directly as Vector Tiles in a web application with live reload capabilities.</p>

            <p><a class="edit" href="https://github.com/apache/incubator-baremaps-site/edit/main/examples/import-osm-into-postgis/index.md"><i class="fas fa-edit"></i> Improve this page</a></p>
          </article>
      </div>
    </div>
    <script async defer src="https://kit.fontawesome.com/14dcd5fdfb.js" crossorigin="anonymous"></script>
    <script async defer src="https://buttons.github.io/buttons.js" crossorigin="anonymous"></script>
  </body>
</html>
